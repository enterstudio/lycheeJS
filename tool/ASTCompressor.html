<!doctype html>
<html>
<head>
	<title>LycheeJS AST Compressor Inspector</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<!-- libraries -->
	<script src="../lychee/core.js"></script>
	<script src="../lychee/platform/html/Builder.js"></script>

	<!-- demo -->
	<link rel="stylesheet" href="../demo/source/Main.css">

	<style>
		body {
			overflow: hidden;
		}
		#demo-navi {
			padding: 1em;
		}
		#demo-navi label {
			display: inline-block;
			min-width: 200px;
			height: 30px;
			text-align: left;
			vertical-align: top;
		}
		#demo-navi .lychee-checkbox {
			display: inline-block;
			text-align: left;
			vertical-align: top;
		}
		#demo-navi textarea {
			display: inline-block;
			width: 49%;
			height: 20em;
			font-size: 14px;
			line-height: 16px;
			margin: 1em 2px;
			color: #999;
			border: 2px solid #444;
		}
		#demo-navi textarea:focus {
			color: #000;
			outline: none;
			border: 2px solid #8b2323;
		}
	</style>

</head>
<body>

<div id="demo">
	<h1>LycheeJS AST Compressor Inspector</h1>
	<p class="notification">
		This tool shows you what is being generated by the lychee.Parser and how the <abbr title="Abstract Syntax Tree">AST</abbr> looks like.
	</p>
	<div id="demo-navi">
		<p>
			Unfocus the left textarea to refresh the <abbr title="Abstract Syntax Tree">AST</abbr>.<br>
			Select the text on the left side to scroll to the generated token on the right.
		</p>
		<br>
	</div>
</div>

<script>
lychee.rebase({
	lychee: "../lychee",
	tool: "./source"
});



lychee.define('tool.Main').tags({
	platform: 'html'
}).requires([
	'lychee.ASTCompressor',
	'lychee.Parser',
	'lychee.Preloader',
	'lychee.ui.*'
]).exports(function(lychee, global) {

	var _demo = document.getElementById('demo'),
		_navi = document.getElementById('demo-navi');

	var _AST = [];
	var _preloader = new lychee.Preloader();

	var settings = {
		ast: [],
		exigent: false,
		url: '../test/ASTCompressor/source/function.js'
	};


	function _add(description, element, element2) {

		element = element || null;
		element2 = element2 || null;

		if (description !== null) {
			var label = document.createElement('label');
			label.innerHTML = description;
			_navi.appendChild(label);
		}

		if (element !== null) {
			element.addTo(_navi);
		}

		if (element2 !== null) {
			element2.addTo(_navi);
		}

		var br = document.createElement('br');
		_navi.appendChild(br);

	};


	function _refresh(source) {

		var _parser = new lychee.Parser(source, {
			exigent: settings.exigent
		});


		var ast = null;
		try {
			ast = _parser.getAST();
		} catch(e) {
			global.alert('position ' + e.position + ',line ' + e.line + ',column ' + e.column + ': "' + e.message + '"');
		}


		var _compressor = new lychee.ASTCompressor(ast, {
			root: true
		});

		ast = _compressor.getAST();


		var str = JSON.stringify(ast, null, ' ');
		output.set(str);

	};


	_preloader.bind('ready', function(assets) {
		input.set(assets[settings.url]);
	}, this);



	_add('Exigent Mode', new lychee.ui.Checkbox(settings.exigent, function(state) {
		settings.exigent = state;
	}, this));

	_add('Load File', new lychee.ui.Input('text', settings.url, function(value) {
		settings.url = value;
	}, this), new lychee.ui.Button('Load', function() {
		_preloader.load(settings.url);
	}, this));





	var source = '// Welcome to this test!\n\n(function(lychee, global) {\n\n\tvar x, y = \'dumdidum\', z = 3;\n\n\tdemo(\'tokenizing\', null);\n\tbitwiseoperators(16 >> 2 << 3 >>> 3);\n\tvar test = new lychee.Test(null);\n\n})(this.lychee, this);';

	var input = new lychee.ui.Textarea(source, function() {
		_refresh(input.get());
	}, this);
	input.addTo(_navi);


	var output = new lychee.ui.Textarea('');
	output.addTo(_navi);


	_navi.appendChild(document.createElement('br'));


	new lychee.ui.Button('refresh', function() {
		_refresh(input.get());
	}, this).addTo(_navi);


	// Initial load of predefined URL
	_preloader.load(settings.url);

});



lychee.build('tool.Main', {
	platform: 'html'
});
</script>
</body>
</html>   
